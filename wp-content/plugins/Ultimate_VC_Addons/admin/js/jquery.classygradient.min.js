/*! * jQuery ClassyGradient * www.class.pm * * Written by Marius Stanciu - Sergiu <marius@class.pm> * Licensed under the MIT license www.class.pm/LICENSE-MIT * Version 1.1.0 * */(function(c){c.ClassyGradient=function(w,x){var A={gradient:"0% #02CDE8, 100% #000000",width:300,height:18,point:8,orientation:"vertical",target:null,onChange:function(){},onInit:function(){}},l=c(w),q,n,p,r,s,t,y,z,u,v,e=[];this.settings={};this.__constructor=function(){this.settings=c.extend({},A,x);this.update();this.settings.onInit();return this};this.update=function(){this._setupPoints();this._setup();this._render()};this.getCSS=function(){var a="",m="0%",b="100%",d="left bottom",f="top";"horizontal"=== this.settings.orientation&&(m="100%",b="0%",d="right top",f="left");var h='<svg xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gradient" x1="0%" y1="0%" x2="'+m+'" y2="'+b+'">',g="-webkit-gradient(linear, left top, "+d,k="";c.each(e,function(a,b){g+=", color-stop("+b[0]+", "+b[1]+")";k+=","+b[1]+" "+b[0]+"";h+='<stop offset="'+b[0]+'" style="stop-color:'+b[1]+';" />'});g+=")";k=k.substr(1);h+='</linearGradient></defs><rect fill="url(#gradient)" height="100%" width="100%" /></svg>';h= this._base64(h);a=a+("background: url(data:image/svg+xml;base64,"+h+");\n")+("background: "+g+";\n");a+="background: -moz-linear-gradient("+f+","+k+");\n";a+="background: -webkit-linear-gradient("+f+","+k+");\n";a+="background: -o-linear-gradient("+f+","+k+");\n";a+="background: -ms-linear-gradient("+f+","+k+");\n";return a+="background: linear-gradient("+f+","+k+");"};this.getArray=function(){return e};this.getString=function(){var a="";c.each(e,function(c,b){a+=b[0]+" "+b[1]+","});return a=a.substr(0, a.length-1)};this.setOrientation=function(a){this.settings.orientation=a;this._renderToTarget()};this._setupPoints=function(){e=[];e=c.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){var a=this;l.empty();q=c('<div class="ClassyGradient"></div>');n=c('<canvas class="canvas" width="'+this.settings.width+'" height="'+this.settings.height+'"></canvas>');q.append(n);u=n.get(0).getContext("2d");p=c('<div class="points"></div>'); p.css("width",this.settings.width+Math.round(this.settings.point/2+1)+"px");q.append(p);r=c('<div class="info"></div>');r.append('<div class="arrow"></div>');q.append(r);s=c('<div class="content"></div>');r.append(s);l.hover(function(){l.addClass("hover")},function(){l.removeClass("hover")});t=c('<div class="point-color"><div style="background-color: #00ff00"></div></div>');y=c('<span class="point-position">%</span>');z=c('<a href="#" class="delete"></a>');s.append(t,y,z);l.append(q);t.ColorPicker({color:"#00ff00", onSubmit:function(c,b,d){l.find(".point-color div").css("backgroundColor","#"+b);v.css("backgroundColor","#"+b);a._renderCanvas();a._renderToTarget()},onChange:function(c,b,d){l.find(".point-color div").css("backgroundColor","#"+b);v.css("backgroundColor","#"+b);a._renderCanvas();a._renderToTarget()}});c(document).bind("click",function(){l.is(".hover")||r.hide("fast")});n.unbind("click");n.bind("click",function(m){var b=n.offset(),d=m.pageX-b.left,d=Math.round(100*d/a.settings.width),f="#000000", h=999999999999;c.each(e,function(a,b){parseInt(b[0])<d&&d-parseInt(b[0])<h?(h=d-parseInt(b[0]),f=b[1]):parseInt(b[0])>d&&parseInt(b[0])-d<h&&(h=parseInt(b[0])-d,f=b[1])});e.push([d+"%",f]);e.sort(a._sortByPosition);a._render();c.each(e,function(b,f){f[0]==d+"%"&&a._selectPoint(p.find(".point:eq("+b+")"))})})};this._render=function(){this._initGradientPoints();this._renderCanvas();this._renderToTarget()};this._initGradientPoints=function(){var a=this;p.empty();c.each(e,function(c,b){p.append('<div class="point" style="background-color: '+ b[1]+"; left:"+parseInt(b[0])*a.settings.width/100+'px;"></div>')});p.find(".point").css("width",this.settings.point+"px").css("height",this.settings.point+"px").mouseup(function(){a._selectPoint(this)}).draggable({axis:"x",containment:"parent",drag:function(){a._selectPoint(this);a._renderCanvas();a._renderToTarget()}})};this._selectPoint=function(a){var m=this;v=c(a);var b=c(a).css("backgroundColor"),d=parseInt(c(a).css("left")),d=Math.round(d/this.settings.width*100),b=b.substr(4,b.length),b=b.substr(0, b.length-1);t.ColorPickerSetColor(this._rgbToHex(b.split(",")));t.find("div").css("backgroundColor",this._rgbToHex(b.split(",")));y.html("Position: "+d+"%");z.unbind("click").bind("click",function(){1<e.length&&(e.splice(v.index(),1),m._render(),l.find(".info").hide("fast"));return!1});l.find(".info").css("marginLeft",parseInt(c(a).css("left"))-30+"px").show("fast")};this._renderCanvas=function(){var a=this;e=[];l.find(".point").each(function(m,b){var d=Math.round(parseInt(c(b).css("left"))/a.settings.width* 100),f=c(b).css("backgroundColor").substr(4,c(b).css("backgroundColor").length-5),f=a._rgbToHex(f.split(","));e.push([d+"%",f])});e.sort(a._sortByPosition);this._renderToCanvas();this.settings.onChange(this.getString(),this.getCSS(),this.getArray())};this._renderToElement=function(a,m){var b="0%",d="100%",f="left bottom",h="top";if(a===n||"horizontal"===this.settings.orientation)b="100%",d="0%",f="right top",h="left";var g='<svg xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="gradient" x1="0%" y1="0%" x2="'+ b+'" y2="'+d+'">',k="-webkit-gradient(linear, left top, "+f,e="";c.each(m,function(a,b){k+=", color-stop("+b[0]+", "+b[1]+")";e+=","+b[1]+" "+b[0]+"";g+='<stop offset="'+b[0]+'" style="stop-color:'+b[1]+';" />'});k+=")";e=e.substr(1);g+="</linearGradient></defs>";a===s?(b=parseInt(s.css("borderRadius")),g+='<rect fill="url(#gradient)" height="100%" width="100%" rx="'+b+'" ry="'+b+'" />'):g+='<rect fill="url(#gradient)" height="100%" width="100%" />';g+="</svg>";g=this._base64(g);a.css("background", "url(data:image/svg+xml;base64,"+g+")");a.css("background",k);a.css("background","-moz-linear-gradient("+h+","+e+")");a.css("background","-webkit-linear-gradient("+h+","+e+")");a.css("background","-o-linear-gradient("+h+","+e+")");a.css("background","-ms-linear-gradient("+h+","+e+")");a.css("background","linear-gradient("+h+","+e+")")};this._renderToTarget=function(){null!==this.settings.target&&this._renderToElement(c(this.settings.target),e)};this._renderToCanvas=function(){var a=u.createLinearGradient(0, 0,this.settings.width,0);c.each(e,function(c,b){a.addColorStop(parseInt(b[0])/100,b[1])});u.clearRect(0,0,this.settings.width,this.settings.height);u.fillStyle=a;u.fillRect(0,0,this.settings.width,this.settings.height);this.settings.onChange(this.getString(),this.getCSS(),this.getArray())};this._getGradientFromString=function(a){var e=[];a=a.split(",");c.each(a,function(a,d){var f;"100"==d.substr(d.indexOf("%")-3,d.indexOf("%"))||"100%"==d.substr(d.indexOf("%")-3,d.indexOf("%"))?f="100%":(f=1<d.indexOf("%")? parseInt(d.substr(d.indexOf("%")-2,d.indexOf("%"))):parseInt(d.substr(d.indexOf("%")-1,d.indexOf("%"))),f+="%");var c=d.substr(d.indexOf("#"),7);e.push([f,c])});return e};this._rgbToHex=function(a){function c(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}var b=a[1],d=a[2];return"#"+c(a[0])+c(b)+c(d)};this._sortByPosition=function(a,c){return parseInt(a[0])<parseInt(c[0])?-1:parseInt(a[0])>parseInt(c[0])? 1:0};this._base64=function(a){for(var c="",b,d,e,h,g,k,l=0;l<a.length;)b=a.charCodeAt(l++),d=a.charCodeAt(l++),e=a.charCodeAt(l++),h=b>>2,b=(b&3)<<4|d>>4,g=(d&15)<<2|e>>6,k=e&63,isNaN(d)?g=k=64:isNaN(e)&&(k=64),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k); return c};return this.__constructor()};c.fn.ClassyGradient=function(w){return this.each(function(){if(void 0===c(this).data("ClassyGradient")){var x=new c.ClassyGradient(this,w);c(this).data("ClassyGradient",x)}})}})(jQuery);